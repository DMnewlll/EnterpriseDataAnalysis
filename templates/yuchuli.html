<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高新技术企业数据预处理结果预览</title>
    <!-- 引入 Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <!-- 引入自定义CSS样式 -->
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        header {
            background-color: #007bff;
            color: white;
            padding: 15px 20px;
            text-align: center;
        }
        main {
            padding: 20px;
        }
        #data-preview {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            overflow-x: auto;  /* 横向滚动条 */
        }
        h2 {
            margin-top: 0;
        }
        label {
            font-weight: bold;
        }
        select, button {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 16px;
        }
        button {
            background-color: #007bff;
            color: white;
            cursor: pointer;
            border: none;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #dddddd;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tbody tr:hover {
            background-color: #f9f9f9;
        }
        footer {
            text-align: center;
            padding: 10px 0;
            background-color: #007bff;
            color: white;
            position: relative;
            bottom: 0;
            width: 100%;
        }
        @media (max-width: 768px) {
            select, button {
                width: 100%;
                box-sizing: border-box;
            }
            table {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>高新技术企业数据预处理结果</h1>
    </header>

    <main>
        <section id="data-preview">
            <h2>数据预处理结果</h2>
            <div>
                <label for="city-filter">选择地市:</label>
                <select id="city-filter">
                    <option value="all">全部</option>
                    <option value="南宁">南宁</option>
                    <option value="柳州">柳州</option>
                    <option value="桂林">桂林</option>
                    <option value="梧州">梧州</option>
                    <option value="北海">北海</option>
                    <option value="防城港">防城港</option>
                    <option value="钦州">钦州</option>
                    <option value="贵港">贵港</option>
                    <option value="玉林">玉林</option>
                    <option value="百色">百色</option>
                    <option value="贺州">贺州</option>
                    <option value="河池">河池</option>
                    <option value="来宾">来宾</option>
                    <option value="崇左">崇左</option>
                </select>
                <button id="filter-button">筛选</button>
            </div>
            <table id="data-table">
                <thead>
                    <tr>
                        <th>主从表关联ID</th>
                        <th>帐号</th>
                        <th>数据状态</th>
                        <th>行政区划代码</th>
                        <th>行业代码2017</th>
                        <th>注册资金</th>
                        <th>上市及新三板、四板挂牌情况</th>
                        <th>上市挂牌时间</th>
                        <th>本公司是否为上市挂牌企业主体</th>
                        <th>上市挂牌企业年末市值</th>
                        <th>工业总产值当年价格</th>
                        <th>营业收入</th>
                        <th>其中主营业务收入</th>
                        <th>其中技术收入</th>
                        <th>其中技术转让收入</th>
                        <th>技术承包收入</th>
                        <th>技术咨询与服务收入</th>
                        <th>接受委托研究开发收入</th>
                        <th>产品销售收入</th>
                        <th>其中高新技术产品</th>
                        <th>商品销售收入</th>
                        <th>其他营业收入</th>
                        <th>净利润</th>
                        <th>从业人员期末人数</th>
                        <th>其中留学归国人员</th>
                        <th>其中外籍常驻人员</th>
                        <th>其中引进外籍专家</th>
                        <th>其中当年新增从业人员</th>
                        <th>其中吸纳高校应届毕业生</th>
                        <th>从业人员年平均人数</th>
                        <th>具有研究生学历位人员</th>
                        <th>其中博士</th>
                        <th>其中硕士</th>
                        <th>具有大学本科学历位人员</th>
                        <th>具有大学专科学历人员</th>
                        <th>接受高等教育前为非就业地户籍人员</th>
                        <th>技能人员</th>
                        <th>其中高级技师国家职业资格一级</th>
                        <th>技师国家职业资格二级</th>
                        <th>高级技能人员国家职业资格三级</th>
                        <th>中级技能人员国家职业资格四级</th>
                        <th>初级技能人员国家职业资格五级</th>
                        <th>中层及以上管理人员</th>
                        <th>专业技术人员</th>
                        <th>科技活动人员合计</th>
                        <th>科技活动费用合计</th>
                        <th>当年专利申请数</th>
                    </tr>
                </thead>
                <tbody id="data-table-body">
                <!-- 数据将通过JavaScript动态填充 -->
                </tbody>
            </table>
        </section>
    </main>
    <footer>
        <p>&copy; 2024 高新技术企业数据分析</p>
    </footer>

    <!-- 引入jQuery和Bootstrap JS库 -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
    $(document).ready(function() {
        const $tableBody = $('#data-table-body');
        const $cityFilter = $('#city-filter');

        // 从服务器获取数据，城市为参数
        function getData(city) {
            return $.ajax({
                url: '/getCleanData',
                type: 'POST',
                data: { city },  // 使用传入的城市参数
                dataType: 'json' // 期望的返回数据格式
            });
        }

        // 更新表格数据
        function updateTable(data) {
            $tableBody.empty(); // 清空现有表格数据
            data.forEach(item => {
                const row = `
                    <tr>
                        <td>${item.id}</td>
                        <td>${item.account}</td>
                        <td>${item.dataStatus}</td>
                        <td>${item.administrativeRegionCode}</td>
                        <td>${item.industryCode2017}</td>
                        <td>${item.registeredCapital}</td>
                        <td>${item.listingStatus}</td>
                        <td>${item.listingDate}</td>
                        <td>${item.isListingEntity}</td>
                        <td>${item.marketValue}</td>
                        <td>${item.industryOutputValue}</td>
                        <td>${item.revenue}</td>
                        <td>${item.mainBusinessIncome}</td>
                        <td>${item.technologyIncome}</td>
                        <td>${item.technologyTransferIncome}</td>
                        <td>${item.technologyContractIncome}</td>
                        <td>${item.technologyConsultingIncome}</td>
                        <td>${item.acceptedResearchDevelopmentIncome}</td>
                        <td>${item.productSalesIncome}</td>
                        <td>${item.highTechProductIncome}</td>
                        <td>${item.goodsSalesIncome}</td>
                        <td>${item.otherRevenue}</td>
                        <td>${item.netProfit}</td>
                        <td>${item.employeesEndOfPeriod}</td>
                        <td>${item.returnedStudents}</td>
                        <td>${item.foreignResidents}</td>
                        <td>${item.foreignExperts}</td>
                        <td>${item.newEmployees}</td>
                        <td>${item.graduateStudents}</td>
                        <td>${item.averageEmployees}</td>
                        <td>${item.postgraduateEmployees}</td>
                        <td>${item.doctorateEmployees}</td>
                        <td>${item.masterEmployees}</td>
                        <td>${item.bachelorEmployees}</td>
                        <td>${item.associateDegreeEmployees}</td>
                        <td>${item.nonEmployedBeforeHigherEducation}</td>
                        <td>${item.technicians}</td>
                        <td>${item.seniorTechnicians}</td>
                        <td>${item.techniciansLevel2}</td>
                        <td>${item.seniorSkillsLevel4}</td>
                        <td>${item.intermediateSkillsLevel5}</td>
                        <td>${item.juniorSkillsLevel5}</td>
                        <td>${item.middleManagementPersonnel}</td>
                        <td>${item.professionalTechnicalPersonnel}</td>
                        <td>${item.scienceAndTechnologyPersonnel}</td>
                        <td>${item.scienceAndTechnologyExpenses}</td>
                        <td>${item.patentApplications}</td>
                    </tr>
                `;
                $tableBody.append(row);
            });
        }

    // 填充城市筛选下拉框 (保持原有选项)
    function populateCityFilter(data) {
        // 这里我们假设你希望符合特定匹配,比如只添加新城市
        const existingCities = $cityFilter.find('option').map(function() {
            return $(this).val();
        }).toArray(); // 获取现有选项的值

        const uniqueCities = [...new Set(data.map(item => item.city))];

        uniqueCities.forEach(city => {
            if (!existingCities.includes(city)) {
                $cityFilter.append(new Option(city, city)); // 仅添加新的城市
            }
        });
    }

        // 初始化函数，抓取所有数据并填充表格和下拉框
        function initialize() {
            getData('all').done(function(response) {
                if (response && response.result) {
                    updateTable(response.result); // 更新表格
                    populateCityFilter(response.result); // 填充城市筛选
                } else {
                    console.error('获取数据失败：', response);
                }
            }).fail(function() {
                console.error('请求失败');
            });
        }

        // 处理城市筛选器的变化事件
        $cityFilter.change(function() {
            const selectedCity = $(this).val();
            getData(selectedCity).done(function(response) {
                if (response && response.result) {
                    updateTable(response.result); // 更新表格
                } else {
                    console.error('获取数据失败：', response);
                }
            }).fail(function() {
                console.error('请求失败');
            });
        });

        // 页面加载时初始化数据
        initialize();
    });
</script>
</body>
</html>
